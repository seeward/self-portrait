<head>

  <title>Self Portrait</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.6.0.slim.min.js"></script>
  <script src="jquery.steps.min.js"></script>
  <link href="steps.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@magenta/image@0.2.1/dist/magentaimage.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bs-stepper/dist/js/bs-stepper.min.js"></script>
  <!-- Load three.js -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.106.2/build/three.min.js"></script>
  <!-- Load scatter-gl.js -->
  <script src="https://cdn.jsdelivr.net/npm/scatter-gl@0.0.1/lib/scatter-gl.min.js"></script>
  <style>
    body {
      background-color: black;

    }

    .canvas-wrapper,
    #scatter-gl-container {
      display: inline-block;
      vertical-align: top;
      margin-top: 20px;
    }

    a,
    a:hover,
    a:visited {
      color: #1F5359
    }

    .canvas-wrapper {

      border-radius: 25px;
    }

    .canvas-wrapper canvas {
      border-radius: 25px;

    }

    #scatter-gl-container {
      position: relative;
      border-radius: 25px;

    }

    /* center the canvas within its wrapper */
    #scatter-gl-container canvas {
      transform: translate3d(-50%, -50%, 0);
      left: 50%;
      top: 50%;
      position: absolute;
      border-radius: 25px;
    }
  </style>

</head>

<body style="margin: 10px">
  <div id="main">

    <div class="container">
      <div class="row">
        <div class="col-3">
          <div class="container"
            style="padding: 15px;border:1px solid white;height: 630px;text-align: center;border-radius: 10px;background-color: #1F5359!important;">
            <img src="identity-logo.png" width="100%" style="margin-bottom: 5px;background-color: white; padding: 5px;border-radius: 5px;"/>

            <div id="into" style="color: black;">
              <button type="button" class="btn" style="margin:0;padding:0" data-bs-toggle="popover" title="Face Mesh"
                data-bs-trigger="focus"
                data-bs-content="A face mesh is a map of 468 physical locations on your face. Each location is an X,Y and Z location in 3D space that can be used to calculate a person's facial fingerprint. In computer graphics a face mesh is often rendered as a Polygon Mesh represnting each location in a 3D virtural space.">
                <img src="mesh_example.jpg" style="border-radius: 10px;margin-bottom: 20px;border:1px solid white"
                  width="250" />
              </button>

              <br />

              <h4><strong>A Mask Tells Us</strong></h4>
              <h4></h4>
              <h4><strong>More Than a Face</strong></h4>
              <p>Oscar Wilde</p>

            </div>

            <div class="canvas-wrapper">
              <canvas id="output" style="border: 1px solid white;display:none"></canvas>
              <video id="video" playsinline style="
                  -webkit-transform: scaleX(-1);
                  transform: scaleX(-1);
                  visibility: hidden;
                  width: auto;
                  height: auto;
                  
                  ">
              </video>
            </div>
            <br />
            <div id="scatter-gl-container"></div>

          </div>
          <div class="row">
            <div class="col-2">
              <img src="spinner.gif" style="display:none;margin-top: 10px;" id="loader" width="25" />
            </div>
            <div class="col-10">
              <p style="margin-left: 10px;margin-top: 10px;bottom: 15px;color:white" id="userMessage"></p>
            </div>
          </div>


          </p>

          <!-- <img src="logo.png" style="border-radius: 3px;" width="50" /> -->
        </div>
        <div class="col-9">
          <div id="example-basic">
            <h3>Start</h3>
            <section>
              <div class="container">
                <div class="row">
                  <div class="col-8">
                    <div class="container">
                      <p>
                        Increasingly our identity is being compressed down to the numeric result of
                        <a target="_blank"
                          href="https://en.wikipedia.org/wiki/Facial_recognition_system#:~:text=Popular%20recognition%20algorithms%20include%20principal,neuronal%20motivated%20dynamic%20link%20matching.">
                          facial recognition</a>
                        algorithms. Thousands of micro-calculations performed almost instantly on the distance between
                        the physical points on our faces (and Irises).
                        The long floating point numbers, the result of these calculations, get recorded and re-tested
                        and eventually become, to a certain degree,
                        the proof of who we are. (atleast to the machines...)
                      </p>
                      <code
                        style="margin-bottom: 20px!important;">{ "your_identity" : "erwewewrg8jwefhweuf8wehwr9" }</code>

                      <p style="margin-top: 20px!important;">
                        Identity Mesh is an opportunity to discover, explore and even get creative with this same
                        mathematically compressed identity produced by <a
                          href="https://paperswithcode.com/task/facial-landmark-detection" target="_blank">Face Mesh</a>
                        and facial recognition technologies.
                        The source material of your creations will be your own face mesh coordinates.</p>
                      <p>Click next down below to get started...</p>
                    </div>
                  </div>
                  <div class="col" style="text-align: center;">
                    <button type="button" class="btn" style="margin:0;padding:0" data-bs-toggle="popover" 
                    title="Facial Recognition"
                    data-bs-trigger="focus"
                    data-bs-content="Apple introduced Face ID on the flagship iPhone X as a biometric authentication. Face ID has a facial recognition sensor that consists of two parts: 
                    a 'Romeo' module that projects more than 30,000 infrared dots onto the user's face, and a 'Juliet' module that reads the pattern.">
                    <img src="identity.gif" width="200" style="border-radius: 10px" />
                    </button>
                  </div>
                </div>



              </div>
            </section>
            <h3>Encode</h3>
            <section style="height: 500px">
              <div class="container">
                <div class="row">
                  <div class="col-4" style="text-align: center;">
                    <button class="btn btn-dark" style="width:100%;margin-bottom: 25px;" id="init" type="button">Start Video</button>
                    <p>
                      We will need to have some input in order to generate the Face Mesh.
                      You will need to have access to a webcam and click the 'Start Video' button.
                      You will need to allow the browser to access your webcam signal the first time you turn on your webcam.
                    </p>
                  </div>
                  <div class="col-8">
                    <div class="container">
                      
                      <p>
                        Once your video is enabled you will see a face mesh has been rendered on top of your live video.
                        The mesh that is drawn over your face is a result of the FaceMesh machine learning algorithm. It takes the video stream and almost instantly predicts where the hundreds of
                        points on your face will be in the next video frame. Then code draws the points (and the lines between) 
                        and renders it over the next frame of the live video stream. This is the same technology behind augmented reality systems where machine learning models predict the objects 
                        in the real world and overlay virtual objects that match up.
                      </p>
                      <p>
                        Below the video feed is a scatter chart of the 3D points on your face that are being extracted from your video stream. These 
                        landmarks are fed into a charting engine that plots each point as a vector (x,y,z). This chart is rerendered every 1/30 of a second to give it a real-time feel.
                        You can click on the scatter chart and navigate around to explore your personal embedded landmarks. 
                      </p>
                    </div>
                  </div>
                </div>
              </div>


            </section>
            <h3>Generate</h3>
            <section>
              <div class="container">
                <div class="row">
                  <div class="col-4">
                    <button class="btn btn-dark" style="width: 100%" id="transfer" type="button">Generate 3D
                      Model</button>
                    <div style="margin-top: 20px;">
                      <p>Now that we have captured the landmarks of your face, we can generate a 3D model by clicking
                        the 'Generate 3D Model' button.
                        Try to get your face in the center of the image before you click the button. If you need to
                        remake your model you can click the button again.
                      </p>
                      <p>
                        Once your model is generated you can navigate around the 3D space with your mouse or trackpad.
                      </p>
                    </div>
                  </div>
                  <div class="col-8">

                    <div class="container">
                      <iframe id="world" style="display:none;width: 500px;height: 500px;border-radius: 25px;"></iframe>

                    </div>
                  </div>
                </div>
              </div>
            </section>
            <h3>Create</h3>
            <section>
              <div class="container">
                <div class="row">
                  <div class="col-4" style="margin:0;padding:0">

                    <button class="btn btn-dark" id="capture" style="width:100%;margin-bottom: 5px;"
                      type="button">Capture Portrait</button>

                    <select class="form-select" style="width:100%;margin-bottom: 5px;" id="captureType"
                      aria-label="Default select example">
                      <option value="#" selected>Select Capture Type</option>
                      <option value="1">Face with Mesh Overlay</option>
                      <option value="2">Face Mesh Only - Points</option>
                      <option value="3">Face Mesh Only - 3D Polygon</option>

                    </select>

                    <img id="result" style="display: none;border: 1px solid white;margin:0;padding:0" src="" width="250"
                      height="250" />


                    <button class="btn btn-dark" id="ml" style="display:none;width:100%;margin-bottom: 5px;"
                      type="button">Generate Machine Portrait</button>
                      
                   
                        <div class="row">
                          <div class="col-10">
                            <select class="form-select" style="width:100%;margin-top: 20px;display:none;" id="styles"
                            aria-label="Default select example">
                            <option value="#" selected>Select Transfer Style:</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                            <option value="4">Four</option>
                            <option value="5">Five</option>
                            <option value="6">Six</option>
                            <option value="7">Seven</option>
                            <option value="8">Eight</option>
                            <option value="9">Nine</option>
                            <option value="10">Ten</option>
                            <option value="11">Eleven</option>
                          </select>
                          </div>
                          <div class="col-2">
                            <img id="sourceStyle" style="display: none;border-radius: 25px;margin-left: -10px;margin-top: 15px;" src="" width="50"
                            height="50" />
                          </div>
                        </div>
                 
                    
                    
                    <!-- <input style="width:100%;margin-top: 5px;" type="file" onchange="handleLocalImage" class="form-control-file" id="localfile"> -->



                  </div>
                  <div class="col-8">
                    <div class="container" style="text-align: center;">

                      <img id="styledResult" style="display: none;border-radius: 25px;padding:20px" src="" width="500"
                        height="500" />
                      <div id="summary" style="text-align: left;">
                        <p>Now we can get down to some creativity. Using a style transfer machine learning algorithm, 
                          you can make new machine styled portraits from your personally generated face mesh. 
                          On the left you can select three types of images to capture 
                        as the source of your portrait. <br />After selecting one of the options and clicking the 'Capture Portrait' button, you should see the portrait loaded 
                        underneath the buttons on the left.</p>
                        <span id="summaryPart2" style="display: none;">
                          <p >
                            Now you can select a style on the left to apply to the portrait you just took. Each style will be 
                            applied to your portrait by the Style Transfer algorithm. You can take multiple portraits and re-apply the styles
                             to the new captured portraits. 
                             </p>
                             <p>
                              When you have something you like, click over to the next tab to finalize the process.
                            </p>
                        </span>
                        
                        
                      </div>

                    </div>
                  </div>
                </div>
              </div>

            </section>
            <h3>Propagate</h3>
            <section>
              <div class="container">
                <div class="row">
                  <div class="col-4">
                    <p>Here you will make an NFT and agree to share your images with the project... more to come</p>
                    <a target="_blank" href="https://opensea.io/collection/rac-self-portraits">Project NFT Collection</a>
                  <div style="width: 100%; height: 200px;overflow-y: scroll;">
                  </div>
                  </div>

                  <div class="col-8">
                    <img src="" id="nftCandidate" width="450" height="450"/>
                  </div>
                </div>
              </div>
            </section>
          </div>
        </div>
        <canvas id="stylized1" style="display: none;" src="" width="250" height="250" />
      </div>
    </div>





    <div class="container" style="padding: 5px;margin-top: 1000px;">
      <div class="row">
        <div class="col-md-5">


        </div>
        <div class="col-md-2">

          <div class="d-grid gap-2">
            <!-- <button class="btn btn-dark" id="init" type="button">Init</button> -->

            <br />
            <!-- <button class="btn btn-dark" id="localfileprocess" type="button">Extract Face Mesh</button> -->
          </div>
          <!-- <button type="button" id="capture" class="btn btn-light">Capture</button> -->
        </div>
        <div class="col-md-5">
          <iframe id="world" style="display:none;width: 500px;height: 500px;border-radius: 25px;"></iframe>
        </div>
      </div>





    </div>




    <div>

      <img id="style1" style="display: none;" src="style1.png" width="250" height="250" />

      <img id="style2" style="display: none;" src="style2.jpg" width="250" height="250" />

      <img id="style3" style="display: none;" src="style3.jpg" width="250" height="250" />

      <img id="style4" style="display: none;" src="style4.jpg" width="250" height="250" />

      <img id="style5" style="display: none;" src="style5.jpg" width="250" height="250" />

      <img id="style6" style="display: none;" src="style6.jpg" width="250" height="250" />

      <img id="style7" style="display: none;" src="style7.jpg" width="250" height="250" />

      <img id="style8" style="display: none;" src="style8.jpg" width="250" height="250" />

      <img id="style9" style="display: none;" src="style9.jpg" width="250" height="250" />

      <img id="style10" style="display: none;" src="style10.jpg" width="250" height="250" />

      <img id="style11" style="display: none;" src="style11.jpg" width="250" height="250" />

      <canvas id="shadowmesh" style="display:none" src="" width="250" height="250" />
      <canvas id="shadowpoints" style="display:none" src="" width="250" height="250" />


    </div>




    <script>

      jQuery(document).ready(function () {
        // $("#wizard").steps();
        // jQuery("#example-basic").steps({
        //   headerTag: "h3",
        //   bodyTag: "section",
        //   autoFocus: true,
        //   onStepChanging: stepHandler
        // });
        // var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
        // var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
        //   return new bootstrap.Popover(popoverTriggerEl)
        // })
        // jQuery("#localfile").on('change', function () {
        //   handleLocalImage()
        // });
      });

      function handleLocalImage() {
        console.log('into')

        const input = document.querySelector('#localfile')
        if (input.files && input.files[0]) {
          var reader = new FileReader();

          reader.onload = function (e) {

            document.querySelector('#result').style.display = 'inline'
            document.querySelector('#result').style.borderRadius = '25px'
            document.querySelector('#result').style.margin = '20px'
            document.querySelector('#result').src = e.target.result
          }
          reader.readAsDataURL(input.files[0]);
        }
      }
    </script>

  </div>
  </div>

  <canvas id="localoutput" style="display:none" src="" width="500" height="500" />


</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.6/dat.gui.min.js"></script>

<script src="index.js"></script>